<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ==================== CSS VARIABLES ==================== */
        :root {
            /* Theme Colors */
            --primary-color: #3390ec;
            --secondary-color: #f5f5f5;
            --success-color: #4CAF50;
            --text-primary: #000000;
            --text-secondary: #999999;
            --border-color: #e0e0e0;
            --bg-color: #ffffff;
            --overlay-bg: rgba(0, 0, 0, 0.85);
            
            /* Spacing System */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 16px;
            --spacing-xl: 20px;
            --spacing-2xl: 24px;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            /* Typography */
            --font-size-xs: 10px;
            --font-size-sm: 11px;
            --font-size-base: 14px;
            --font-size-md: 16px;
            --font-size-lg: 20px;
            --font-size-xl: 28px;
            --font-size-2xl: 36px;
            --font-size-3xl: 48px;
            
            /* Nav Height */
            --nav-height: 80px;
            
            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* ==================== BASE STYLES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            padding-bottom: var(--nav-height);
            background-color: var(--bg-color);
            color: var(--text-primary);
        }

        /* ==================== PAGE LAYOUT ==================== */
        .page {
            display: none;
            padding: var(--spacing-xl);
            min-height: calc(100vh - var(--nav-height));
            animation: fadeIn var(--transition-normal);
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* ==================== TYPOGRAPHY ==================== */
        .page-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-xl);
            color: var(--text-primary);
        }

        .page-description {
            font-size: var(--font-size-md);
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
            color: var(--text-primary);
        }

        /* ==================== CARD COMPONENT ==================== */
        .card {
            background: var(--secondary-color);
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            transition: transform var(--transition-fast);
        }

        .card:active {
            transform: scale(0.98);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
        }

        .card-text {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* ==================== CASH PAGE SPECIFIC ==================== */
        .cash-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - var(--nav-height) - 40px);
            gap: var(--spacing-2xl);
        }

        .balance-section {
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        .balance-label {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .balance-amount {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--success-color);
            margin-bottom: var(--spacing-xs);
            text-shadow: 0 2px 10px rgba(76, 175, 80, 0.3);
        }

        .balance-currency {
            font-size: var(--font-size-lg);
            color: var(--text-secondary);
        }

        /* Earn Button */
        .earn-button {
            position: relative;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: var(--spacing-2xl) var(--spacing-2xl);
            border-radius: var(--radius-xl);
            font-size: var(--font-size-lg);
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            max-width: 320px;
            box-shadow: 0 8px 24px rgba(76, 175, 80, 0.4);
            transition: all var(--transition-fast);
            animation: pulse 2s infinite;
            -webkit-tap-highlight-color: transparent;
        }

        .earn-button:active {
            transform: scale(0.95);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 8px 24px rgba(76, 175, 80, 0.4);
            }
            50% {
                box-shadow: 0 8px 32px rgba(76, 175, 80, 0.6);
            }
        }

        .earn-button-text {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .earn-amount {
            font-size: var(--font-size-2xl);
            font-weight: 800;
        }

        .earn-cta {
            font-size: var(--font-size-md);
            opacity: 0.9;
        }

        /* Stats Section */
        .stats-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
            width: 100%;
            max-width: 400px;
        }

        .stat-card {
            background: var(--secondary-color);
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            text-align: center;
        }

        .stat-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ==================== VIDEO OVERLAY ==================== */
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay-bg);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeInOverlay var(--transition-normal);
        }

        .video-overlay.active {
            display: flex;
        }

        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .video-container {
            width: 90%;
            max-width: 500px;
            background: #000;
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
            animation: slideUp var(--transition-normal);
        }

        @keyframes slideUp {
            from { 
                transform: translateY(100px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        .video-player {
            width: 100%;
            height: auto;
            display: block;
            background: #000;
        }

        .video-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
        }

        .video-progress-bar {
            height: 100%;
            background: var(--success-color);
            width: 0%;
            transition: width 0.3s linear;
        }

        .video-close {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: var(--font-size-lg);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .video-close.show {
            display: flex;
        }

        /* Reward Animation */
        .reward-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            text-align: center;
            z-index: 10000;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: none;
        }

        .reward-popup.active {
            display: block;
            animation: rewardPop 0.5s ease forwards;
        }

        @keyframes rewardPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .reward-emoji {
            font-size: 64px;
            margin-bottom: var(--spacing-md);
        }

        .reward-text {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--success-color);
            margin-bottom: var(--spacing-sm);
        }

        .reward-amount {
            font-size: var(--font-size-2xl);
            font-weight: 800;
            color: var(--success-color);
        }

        /* ==================== BOTTOM NAVIGATION ==================== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            padding: var(--spacing-md) 0;
            padding-bottom: max(var(--spacing-xl), env(safe-area-inset-bottom));
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
            z-index: 1000;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-lg);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all var(--transition-fast);
            border-radius: var(--radius-md);
            min-width: 80px;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .nav-btn.active {
            color: var(--primary-color);
            background: color-mix(in srgb, var(--primary-color) 15%, transparent);
            box-shadow: 0 2px 8px color-mix(in srgb, var(--primary-color) 25%, transparent);
        }

        .nav-btn.active::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 0 0 3px 3px;
        }

        .nav-icon {
            font-size: 24px;
            transition: transform var(--transition-fast);
        }

        .nav-btn.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-label {
            font-size: var(--font-size-sm);
            font-weight: 500;
        }

        /* ==================== UTILITY CLASSES ==================== */
        .mb-sm { margin-bottom: var(--spacing-sm); }
        .mb-md { margin-bottom: var(--spacing-md); }
        .mb-lg { margin-bottom: var(--spacing-lg); }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 360px) {
            :root {
                --spacing-xl: 16px;
                --font-size-xl: 24px;
                --font-size-2xl: 32px;
                --font-size-3xl: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- ==================== QUESTS PAGE ==================== -->
    <div id="quests" class="page">
        <h1 class="page-title" data-i18n="quests.title">üéØ –ö–≤–µ—Å—Ç—ã</h1>
        <p class="page-description" data-i18n="quests.description">–í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–∞–π –Ω–∞–≥—Ä–∞–¥—ã</p>
        <div class="card">
            <h3 class="card-title" data-i18n="quests.quest1.title">–ö–≤–µ—Å—Ç 1</h3>
            <p class="card-text" data-i18n="quests.quest1.text">–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∫–≤–µ—Å—Ç–∞</p>
        </div>
        <div class="card">
            <h3 class="card-title" data-i18n="quests.quest2.title">–ö–≤–µ—Å—Ç 2</h3>
            <p class="card-text" data-i18n="quests.quest2.text">–û–ø–∏—Å–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∫–≤–µ—Å—Ç–∞</p>
        </div>
        <div class="card">
            <h3 class="card-title" data-i18n="quests.quest3.title">–ö–≤–µ—Å—Ç 3</h3>
            <p class="card-text" data-i18n="quests.quest3.text">–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ—Ç—å–µ–≥–æ –∫–≤–µ—Å—Ç–∞</p>
        </div>
    </div>

    <!-- ==================== CASH PAGE ==================== -->
    <div id="cash" class="page active">
        <div class="cash-container">
            <!-- Balance Display -->
            <div class="balance-section">
                <div class="balance-label" data-i18n="cash.balance">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount">
                    <span id="balance-value">12.45</span>
                    <span class="balance-currency">$</span>
                </div>
            </div>

            <!-- Earn Button -->
            <button class="earn-button" id="earn-btn">
                <div class="earn-button-text">
                    <div class="earn-cta" data-i18n="cash.earn">–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å</div>
                    <div class="earn-amount">+$0.05 üí∞</div>
                </div>
            </button>

            <!-- Stats -->
            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-value" id="today-count">12</div>
                    <div class="stat-label" data-i18n="cash.today">–°–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-earned">$145.20</div>
                    <div class="stat-label" data-i18n="cash.total">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== FAQ PAGE ==================== -->
    <div id="faq" class="page">
        <h1 class="page-title" data-i18n="faq.title">‚ùì FAQ</h1>
        <p class="page-description" data-i18n="faq.description">–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</p>
        <div class="card">
            <h3 class="card-title" data-i18n="faq.question1.title">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
            <p class="card-text" data-i18n="faq.question1.text">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å</p>
        </div>
        <div class="card">
            <h3 class="card-title" data-i18n="faq.question2.title">–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É?</h3>
            <p class="card-text" data-i18n="faq.question2.text">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å</p>
        </div>
        <div class="card">
            <h3 class="card-title" data-i18n="faq.question3.title">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
            <p class="card-text" data-i18n="faq.question3.text">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</p>
        </div>
    </div>

    <!-- ==================== VIDEO OVERLAY ==================== -->
    <div class="video-overlay" id="video-overlay">
        <div class="video-container">
            <button class="video-close" id="video-close">‚úï</button>
            <video class="video-player" id="video-player" playsinline>
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
            </video>
            <div class="video-progress">
                <div class="video-progress-bar" id="progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- ==================== REWARD POPUP ==================== -->
    <div class="reward-popup" id="reward-popup">
        <div class="reward-emoji">üéâ</div>
        <div class="reward-text" data-i18n="cash.earned">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ!</div>
        <div class="reward-amount">+$0.05</div>
    </div>

    <!-- ==================== BOTTOM NAVIGATION ==================== -->
    <nav class="bottom-nav">
        <button class="nav-btn" data-page="quests">
            <span class="nav-icon">üéØ</span>
            <span class="nav-label" data-i18n="nav.quests">–ö–≤–µ—Å—Ç—ã</span>
        </button>
        <button class="nav-btn active" data-page="cash">
            <span class="nav-icon">üí∞</span>
            <span class="nav-label" data-i18n="nav.cash">–ó–∞—Ä–∞–±–æ—Ç–æ–∫</span>
        </button>
        <button class="nav-btn" data-page="faq">
            <span class="nav-icon">‚ùì</span>
            <span class="nav-label" data-i18n="nav.faq">FAQ</span>
        </button>
    </nav>

    <script>
        // ==================== CONFIG ====================
        const CONFIG = {
            defaultLanguage: 'ru',
            hapticFeedback: true,
            debugMode: false,
            rewardAmount: 0.05,
            videoDuration: 30 // seconds
        };

        // ==================== TRANSLATIONS ====================
        const translations = {
            ru: {
                nav: {
                    quests: '–ö–≤–µ—Å—Ç—ã',
                    cash: '–ó–∞—Ä–∞–±–æ—Ç–æ–∫',
                    faq: 'FAQ'
                },
                cash: {
                    balance: '–í–∞—à –±–∞–ª–∞–Ω—Å',
                    earn: '–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å',
                    today: '–°–µ–≥–æ–¥–Ω—è',
                    total: '–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ',
                    earned: '–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ!'
                },
                quests: {
                    title: 'üéØ –ö–≤–µ—Å—Ç—ã',
                    description: '–í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–∞–π –Ω–∞–≥—Ä–∞–¥—ã',
                    quest1: {
                        title: '–ö–≤–µ—Å—Ç 1',
                        text: '–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∫–≤–µ—Å—Ç–∞'
                    },
                    quest2: {
                        title: '–ö–≤–µ—Å—Ç 2',
                        text: '–û–ø–∏—Å–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∫–≤–µ—Å—Ç–∞'
                    },
                    quest3: {
                        title: '–ö–≤–µ—Å—Ç 3',
                        text: '–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ—Ç—å–µ–≥–æ –∫–≤–µ—Å—Ç–∞'
                    }
                },
                faq: {
                    title: '‚ùì FAQ',
                    description: '–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã',
                    question1: {
                        title: '–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?',
                        text: '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å'
                    },
                    question2: {
                        title: '–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É?',
                        text: '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å'
                    },
                    question3: {
                        title: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞',
                        text: '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
                    }
                }
            },
            en: {
                nav: {
                    quests: 'Quests',
                    cash: 'Earn',
                    faq: 'FAQ'
                },
                cash: {
                    balance: 'Your Balance',
                    earn: 'Earn',
                    today: 'Today',
                    total: 'Total Earned',
                    earned: 'Earned!'
                },
                quests: {
                    title: 'üéØ Quests',
                    description: 'Complete tasks and earn rewards',
                    quest1: {
                        title: 'Quest 1',
                        text: 'Description of the first quest'
                    },
                    quest2: {
                        title: 'Quest 2',
                        text: 'Description of the second quest'
                    },
                    quest3: {
                        title: 'Quest 3',
                        text: 'Description of the third quest'
                    }
                },
                faq: {
                    title: '‚ùì FAQ',
                    description: 'Frequently asked questions',
                    question1: {
                        title: 'How does it work?',
                        text: 'Answer to the question will be here'
                    },
                    question2: {
                        title: 'How to get a reward?',
                        text: 'Answer to the question will be here'
                    },
                    question3: {
                        title: 'Technical Support',
                        text: 'Contact information will be here'
                    }
                }
            }
        };

        // ==================== APP STATE ====================
        class AppState {
            constructor() {
                this.balance = parseFloat(localStorage.getItem('balance') || '12.45');
                this.todayCount = parseInt(localStorage.getItem('todayCount') || '12');
                this.totalEarned = parseFloat(localStorage.getItem('totalEarned') || '145.20');
            }

            updateBalance(amount) {
                this.balance += amount;
                this.todayCount += 1;
                this.totalEarned += amount;
                this.save();
            }

            save() {
                localStorage.setItem('balance', this.balance.toFixed(2));
                localStorage.setItem('todayCount', this.todayCount.toString());
                localStorage.setItem('totalEarned', this.totalEarned.toFixed(2));
            }

            getBalance() {
                return this.balance.toFixed(2);
            }

            getTodayCount() {
                return this.todayCount;
            }

            getTotalEarned() {
                return '$' + this.totalEarned.toFixed(2);
            }
        }

        // ==================== VIDEO PLAYER ====================
        class VideoPlayer {
            constructor(app) {
                this.app = app;
                this.overlay = document.getElementById('video-overlay');
                this.video = document.getElementById('video-player');
                this.closeBtn = document.getElementById('video-close');
                this.progressBar = document.getElementById('progress-bar');
                this.canSkip = false;
                this.watchedPercentage = 0;
                
                this.init();
            }

            init() {
                // Video events
                this.video.addEventListener('timeupdate', () => this.onProgress());
                this.video.addEventListener('ended', () => this.onVideoEnd());
                
                // Close button
                this.closeBtn.addEventListener('click', () => this.close());
            }

            open() {
                this.overlay.classList.add('active');
                this.video.currentTime = 0;
                this.canSkip = false;
                this.watchedPercentage = 0;
                this.closeBtn.classList.remove('show');
                
                // Play video
                this.video.play().catch(err => {
                    console.error('Video play error:', err);
                });
                
                // Haptic
                if (CONFIG.hapticFeedback && this.app.tg.HapticFeedback) {
                    this.app.tg.HapticFeedback.impactOccurred('medium');
                }
            }

            close() {
                if (!this.canSkip && this.watchedPercentage < 95) {
                    // Can't skip before 95% watched
                    if (CONFIG.hapticFeedback && this.app.tg.HapticFeedback) {
                        this.app.tg.HapticFeedback.notificationOccurred('error');
                    }
                    return;
                }
                
                this.overlay.classList.remove('active');
                this.video.pause();
            }

            onProgress() {
                const percentage = (this.video.currentTime / this.video.duration) * 100;
                this.watchedPercentage = percentage;
                this.progressBar.style.width = percentage + '%';
                
                // Allow skip after 95%
                if (percentage >= 95 && !this.canSkip) {
                    this.canSkip = true;
                    this.closeBtn.classList.add('show');
                }
            }

            onVideoEnd() {
                this.close();
                this.app.onVideoComplete();
            }
        }

        // ==================== MAIN APP ====================
        class MiniApp {
            constructor() {
                this.tg = window.Telegram.WebApp;
                this.currentLang = CONFIG.defaultLanguage;
                this.currentPage = 'cash';
                this.state = new AppState();
                this.videoPlayer = new VideoPlayer(this);
                
                this.init();
            }

            init() {
                // Initialize Telegram WebApp
                this.tg.expand();
                this.tg.ready();
                this.applyTelegramTheme();
                
                // Detect user language
                this.detectLanguage();
                
                // Initialize navigation
                this.initNavigation();
                
                // Apply translations
                this.applyTranslations();
                
                // Initialize earn button
                this.initEarnButton();
                
                // Update UI
                this.updateUI();
                
                // Log for debugging
                if (CONFIG.debugMode) {
                    console.log('User:', this.tg.initDataUnsafe.user);
                    console.log('Language:', this.currentLang);
                }
            }

            applyTelegramTheme() {
                const root = document.documentElement;
                const theme = this.tg.themeParams;
                
                if (theme.bg_color) root.style.setProperty('--bg-color', theme.bg_color);
                if (theme.text_color) root.style.setProperty('--text-primary', theme.text_color);
                if (theme.hint_color) root.style.setProperty('--text-secondary', theme.hint_color);
                if (theme.button_color) root.style.setProperty('--primary-color', theme.button_color);
                if (theme.secondary_bg_color) root.style.setProperty('--secondary-color', theme.secondary_bg_color);
                
                document.body.style.backgroundColor = theme.bg_color || '#ffffff';
            }

            detectLanguage() {
                const tgLang = this.tg.initDataUnsafe.user?.language_code;
                
                if (tgLang && translations[tgLang]) {
                    this.currentLang = tgLang;
                } else if (tgLang && tgLang.startsWith('ru')) {
                    this.currentLang = 'ru';
                } else if (translations[tgLang?.substring(0, 2)]) {
                    this.currentLang = tgLang.substring(0, 2);
                }
            }

            applyTranslations() {
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    const translation = this.getTranslation(key);
                    if (translation) {
                        el.textContent = translation;
                    }
                });
            }

            getTranslation
